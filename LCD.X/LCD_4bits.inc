CBLOCK
VARIABLE_CUENTA
GUARDA_DATO
CARACTER
LCD_DATO
DATO
ENDC
    
#DEFINE	    RS	LATC,0
#DEFINE	    E	LATC,1
    
LCD_Init:
    CLRF    TRISD
    BCF	    TRISC,0
    BCF	    TRISC,1
    CALL    Retardo_1ms
    BCF	    RS; MODO COMANDO
    MOVLW   0X30; RD7 RD6 RD5 RD4 RD3 RD2 RD1 RD0 
    CALL    LCD_CONFIG
    CALL    ENABLE
    CALL    Retardo_1ms
    MOVLW   0X30
    CALL    LCD_CONFIG
    CALL    ENABLE
    CALL    Retardo_1ms
    MOVLW   0X30
    CALL    LCD_CONFIG
    CALL    ENABLE
    CALL    Retardo_1ms
    MOVLW   0X20
    CALL    LCD_CONFIG
    MOVLW   0X28
    CALL    DISPLAY_ON
    CALL    LIMPIAR_LCD
    CALL    INCREMENTO
    RETURN
    
LCD_CONFIG:
    ;MOVLW  0X30 -> W = 0X30
    ANDLW   B'11110000'; W = 1111 0000 &
		       ;     0011 0000
		       ; W = 0011 0000
    BCF	    RS; MODO COMANDO
    MOVWF   LCD_DATO
    MOVF    LATD,W; LATD -> W RD0 RD1 RD2 RD3 
    ANDLW   B'00001111'; RD7 - RD4 & RD3 - RD0
			; 0000		1111
			;W = 00001111
    IORWF   LCD_DATO; W = 00001111 OR 00110000 = 00111111
    MOVF    LCD_DATO,W; LCD_DATO -> W
    MOVWF   LATD
    CALL    ENABLE
    RETURN
    
LCD_COMANDO:
    ;0X0C
    MOVWF   DATO; 0X0C
    MOVF    DATO,W; DATO -> 
    CALL    LCD_CONFIG
    SWAPF   DATO,F; 0X0C -> 0XC0
    MOVF    DATO,W
    CALL    LCD_CONFIG
    RETURN
    
DISPLAY_ON:
    MOVLW   0X0C
    CALL    LCD_COMANDO  
    RETURN
LIMPIAR_LCD:
    MOVLW   0X01
    CALL    LCD_COMANDO 
    RETURN
INCREMENTO:
    MOVLW   0X06
    CALL    LCD_COMANDO 
    RETURN
    
LCD_CARACTER:
    MOVWF   CARACTER
    BSF	    RS; CARACTER
    MOVF    CARACTER,W; CARACTER -> W
    CALL    LCD_DATOS
    SWAPF   CARACTER,F; 0X0C -> 0XC0
    MOVF    CARACTER,W
    CALL    LCD_DATOS
    RETURN
LCD_DATOS:
    ANDLW   B'11110000'; W = 1111 0000 &
		       ;     0011 0000
		       ; W = 0011 0000
    MOVWF   LCD_DATO
    MOVF    LATD,W; LATD -> W RD0 RD1 RD2 RD3 
    ANDLW   B'00001111'; RD7 - RD4 & RD3 - RD0
			; 0000		1111
			;W = 00001111
    IORWF   LCD_DATO; W = 00001111 OR 00110000 = 00111111
    MOVF    LCD_DATO,W; LCD_DATO -> W
    MOVWF   LATD
    CALL    ENABLE
    RETURN
    
LCD_LINEA1:
    ADDLW   0X80; W = 7 + 00 = 07
    GOTO    LCD_COMANDO
   
LCD_LINEA2:
    ADDLW  0XC0; LINEA 2
    GOTO   LCD_COMANDO
    
ENABLE:
    CALL    Retardo_1ms
    CALL    Retardo_1ms
    BSF	    E		    ; ENABLE
    CALL    Retardo_1ms
    BCF	    E
    Return

Retardo_1ms:
  MOVWF	    GUARDA_DATO
  MOVLW	    .249
  MOVWF	    VARIABLE_CUENTA
BUCLE_INTERNO:
  NOP
  DECFSZ    VARIABLE_CUENTA, F
  GOTO	    BUCLE_INTERNO
  MOVF	    GUARDA_DATO,W
  RETURN



